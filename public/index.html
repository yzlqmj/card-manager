<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>酒馆角色卡管理器 v6.0</title>
    <link rel="icon" href="ico.ico">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header>
        <h1>酒馆角色卡管理器 v6.0</h1>
        <div class="controls">
            <button id="theme-toggle-btn">🌙</button>
            <button id="scan-btn">扫描变更</button>
            <button id="show-downloader-btn">下载新卡</button>
            <button id="show-face-downloader-btn">下载卡面</button>
            <button id="clear-btn">清除列表</button>
            <button id="show-stats-btn">统计信息</button>
            <button id="show-log-btn">显示日志</button>
        </div>
    </header>
    <div id="category-filter-container" class="category-filters">
        <div class="filter-buttons"></div>
        <div class="filter-toggle">
            <label for="show-unimported-only" class="toggle-switch-label">未导入</label>
            <label class="switch">
                <input type="checkbox" id="show-unimported-only">
                <span class="slider round"></span>
            </label>
            <label for="show-not-localized-only" class="toggle-switch-label" style="margin-left: 20px;">本地化</label>
            <label class="switch">
                <input type="checkbox" id="show-not-localized-only">
                <span class="slider round"></span>
            </label>
        </div>
    </div>

    <div id="stray-cards-container"></div>
    <div id="card-container"></div>

    <div id="downloader-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>角色卡下载器</h2><span class="close-btn" onclick="closeModal('downloader-modal')">×</span></div>
            <div class="modal-body"><div id="downloader-form" class="form-grid"><input type="text" id="download-url" placeholder="粘贴图片链接..." class="full-width"><input type="text" id="character-name" list="character-list" placeholder="角色/文件夹名 (必填)"><datalist id="character-list"></datalist><input type="text" id="file-name" placeholder="文件名 (可选)"><select id="category-select"></select><input type="text" id="new-category" placeholder="或, 输入新分类名"></div></div>
            <div class="modal-footer"><button id="download-btn" style="background-color: var(--success-color);">下载</button></div>
        </div>
    </div>

    <div id="details-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2 id="details-title"></h2><span class="close-btn" onclick="closeModal('details-modal')">×</span></div>
            <div class="modal-body details-grid">
                <div id="details-preview"><img id="details-preview-img" src="" alt="预览图"></div>
                <div id="details-info">
                    <h4>版本列表</h4><ul id="details-version-list" class="version-list"></ul>
                    <div style="margin-top: 24px;"><h4>移动到其他分类</h4><div class="form-grid" style="grid-template-columns: 2fr 1fr; align-items: center;"><select id="details-category-select"></select><button id="details-move-btn" class="styled-btn primary">确认移动</button></div></div>
                    <div style="margin-top: 16px;"><h4>操作</h4><div id="details-actions" class="actions-grid"></div></div>
                </div>
            </div>
            <div id="face-grid-container" class="modal-body" style="display: none; border-top: 1px solid var(--border-color); padding-top: 24px;">
                <h3 style="margin-top: 0; margin-bottom: 16px;">卡面一览</h3>
                <div id="face-grid" class="face-grid-view"></div>
            </div>
        </div>
    </div>

    <div id="organize-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>整理角色卡</h2>
                <span class="close-btn" onclick="closeModal('organize-modal')">×</span>
            </div>
            <div class="modal-body">
                <img id="organize-preview-img" src="" alt="预览图" style="width: 100%; max-height: 300px; object-fit: contain; border-radius: var(--radius); margin-bottom: 16px;">
                <div class="form-grid" style="grid-template-columns: 1fr;">
                    <input type="text" id="organize-char-name" placeholder="角色/文件夹名 (必填)">
                    <select id="organize-category-select"></select>
                    <input type="text" id="organize-new-category" placeholder="或者, 输入新分类名">
                </div>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: space-between;">
                <button id="organize-delete-btn" style="background-color: var(--danger-color);">删除此卡</button>
                <div>
                    <button id="organize-move-btn" style="background-color: var(--primary-color); margin-right: 10px;">归档</button>
                </div>
            </div>
        </div>
    </div>

    <div id="log-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>操作日志</h2>
                <span class="close-btn" onclick="closeModal('log-modal')">×</span>
            </div>
            <div class="modal-body">
                <pre id="log-content" style="white-space: pre-wrap; word-wrap: break-word; max-height: 60vh; overflow-y: auto; background-color: var(--bg-color); padding: 15px; border-radius: var(--radius);"></pre>
            </div>
        </div>
    </div>

    <div id="note-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 id="note-modal-title">角色备注</h2>
                <span class="close-btn" onclick="closeModal('note-modal')">×</span>
            </div>
            <div class="modal-body">
                <div id="note-display" class="note-content" style="display: block;"></div>
                <textarea id="note-edit" class="note-content" style="display: none; height: 40vh;"></textarea>
            </div>
            <div class="modal-footer" id="note-controls">
                <button id="edit-note-btn" class="styled-btn">编辑</button>
                <button id="save-note-btn" class="styled-btn primary" style="display:none;">保存</button>
            </div>
        </div>
    </div>

    <div id="face-downloader-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>卡面下载</h2>
                <span class="close-btn" onclick="closeModal('face-downloader-modal')">×</span>
            </div>
            <div class="modal-body">
                <div class="form-grid" style="grid-template-columns: 1fr;">
                    <input type="text" id="face-char-input" list="face-char-datalist" placeholder="输入角色名进行筛选">
                    <datalist id="face-char-datalist"></datalist>
                </div>
                <div class="actions-grid" style="margin-top: 16px;">
                    <button id="start-listen-clipboard-btn" class="styled-btn success">启用监听</button>
                    <button id="stop-listen-clipboard-btn" class="styled-btn danger">关闭监听</button>
                </div>
                <div style="margin-top: 16px;">
                    <h4>下载日志</h4>
                    <pre id="face-download-log" style="white-space: pre-wrap; word-wrap: break-word; max-height: 30vh; overflow-y: auto; background-color: var(--bg-color); padding: 15px; border-radius: var(--radius);"></pre>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <div id="localization-log-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>本地化日志</h2>
                <span class="close-btn" onclick="closeModal('localization-log-modal')">×</span>
            </div>
            <div class="modal-body">
                <pre id="localization-log-content" style="white-space: pre-wrap; word-wrap: break-word; max-height: 60vh; overflow-y: auto; background-color: var(--bg-color); padding: 15px; border-radius: var(--radius);"></pre>
            </div>
        </div>
    </div>

    <div id="stats-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>统计信息</h2>
                <span class="close-btn" onclick="closeModal('stats-modal')">×</span>
            </div>
            <div class="modal-body">
                <div id="stats-content"></div>
            </div>
        </div>
    </div>

    <div id="merge-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>合并 JSON 到 PNG</h2>
                <span class="close-btn" onclick="closeModal('merge-modal')">×</span>
            </div>
            <div class="modal-body">
                <div class="form-grid" style="grid-template-columns: 1fr;">
                    <label for="merge-json-select">选择 JSON 文件:</label>
                    <select id="merge-json-select"></select>
                    <label for="merge-png-select">选择 PNG 背景图:</label>
                    <select id="merge-png-select"></select>
                </div>
            </div>
            <div class="modal-footer">
                <button id="merge-confirm-btn" class="styled-btn primary">确认合并</button>
            </div>
        </div>
    </div>

<script src="/js/showdown.min.js"></script>
<script src="/js/main.js"></script>
</body>
</html>